<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    @@include('layout/back_style.html')
    <title>樂寵後台管理</title>
</head>

<body class="backend">
    <nav class="navbar navbar-light" style="background-color: #FFC857;">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
              <a href="index.html"><img class="ms-5" src="img/common/i_logo.png" alt="" style="max-width: 50px" /></a>
                <p class="navbar-brand ms-3">樂寵後台管理</p>
            </div>
            <div class="me-5"><a href="#">登出</a></div>
        </div>
    </nav>
    <div class="container mt-5">
        <div class="row">
            <div class="col-2">
                <div class="list-group text-center">
                    <a href="back_member.html" class="
                      list-group-item list-group-item-action list-group-item-success
                    ">會員管理</a>
                    <a href="back_news.html" class="
                      list-group-item list-group-item-action list-group-item-success
                    ">消息管理</a>
                    <a class="
                      list-group-item list-group-item-action list-group-item-success
                    " data-bs-toggle="collapse" href="#order-list" role="button" aria-expanded="false"
                        aria-controls="order-list"><span class="badge bg-success rounded-pill">0</span> 訂單管理</a>
                    <div class="collapse" id="order-list">
                        <a href="back_restaurant_order.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      "><span class="badge bg-success rounded-pill">0</span> 餐廳訂單</a>
                        <a href="back_hotel_order.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      "><span class="badge bg-success rounded-pill">0</span> 旅館訂單</a>
                        <a href="back_hospital_order.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      "><span class="badge bg-success rounded-pill">0</span> 健檢訂單</a>
                        <a href="back_shopping_order.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      "><span class="badge bg-success rounded-pill">0</span> 商城訂單</a>
                    </div>
                    <a class="
                      list-group-item list-group-item-action list-group-item-success
                    " data-bs-toggle="collapse" href="#product-list" role="button" aria-expanded="false"
                        aria-controls="product-list">商品管理</a>
                    <div class="collapse" id="product-list">
                        <a href="back_restaurant_meal.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      ">餐廳餐點</a>
                        <a href="back_room_type.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      ">旅館房型</a>
                        <a href="back_health_check.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      ">健檢項目</a>
                        <a href="back_shopping_product.html" class="
                        list-group-item
                        list-group-item-action
                        list-group-item-secondary
                      ">商城商品</a>
                    </div>
                    <a href="back_message_list.html" class="
                      list-group-item list-group-item-action list-group-item-success
                    "><span class="badge bg-success rounded-pill">0</span> 商城留言</a>
                </div>
            </div>
            <div class="col-10">
                <h2 class="mb-3">健檢項目管理</h2>
                <a href="back_health_check_create.html" class="btn btn-success btn-sm mb-3">新增健檢項目</a>
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <input type="checkbox" id="all">
                        <label for="all">全選</label>
                        <button type="button" class="btn btn-outline-success btn-sm ms-1">上架</button>
                        <button type="button" class="btn btn-outline-success btn-sm ms-1">下架</button>
                    </div>
                    <select>
                        <option value="1">上架中</option>
                        <option value="0">下架中</option>
                    </select>
                </div>
                <table class="table table-striped table-hover text-center">
                    <thead>
                        <tr class="table-warning">
                            <th>項目編號</th>
                            <th>項目名稱</th>
                            <th>價格</th>
                            <th>適用對象</th>
                            <th>編輯</th>
                        </tr>
                    </thead>
                    <tbody class='data'>
                        
                    </tbody>
                </table>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

    <script>
      axios.post("php/back_end_API/C_select.php").then((res)=>{
        getData(res)
      })
      function getData(res){
        for(let i = 0; i< res.data.length; i++){

          let data = `
          <tr>
                <td style="display: none"><input value="${res.data[i].HEALTH_CHECK_ID}" name="HEALTH_CHECK_ID" disabled readonly></td>
                <td>${res.data[i].HEALTH_CHECK_ID}</td>
                <td><input type="text" name="LISTNAME" value="${res.data[i].LISTNAME}" disabled></td>
                <td><input type="number" name="PRICE" value="${res.data[i].PRICE}" disabled></td>
                <td><input type="number" name="TESTING_SUBJECT" value="${res.data[i].TESTING_SUBJECT}" disabled></td>
                <td class="edit"><button class="btn btn-warning btn-sm">編輯</button></td>
                <td style="display: none" class="save"><button class="btn btn-warning btn-sm">儲存</button></td>
          </tr>
          `
          $('.data').append(data)
        }
      }

      // 動態append無法click事件點擊該元件，要改為on綁定先抓到父層後，才點擊該元件。

      //編輯
      $('.data').on('click', '.edit', function(e){
        e.preventDefault()
        $(this).parent().find('input, select').attr('disabled', false)
        $(this).css('display', 'none')
        $(this).next().css('display', 'block')
        $('.noShow').hide()
      });

      //儲存
      $('.data').on('click', '.save', function(){
        $(this).parent().parent().find('input, select').attr('disabled', true)
        $(this).css('display', 'none')
        $(this).prev().css('display', 'block')

        let HEALTH_CHECK_ID = $(this).parent().find("input[name='HEALTH_CHECK_ID']").val()
        let LISTNAME = $(this).parent().find("input[name='LISTNAME']").val()
        let PRICE = $(this).parent().find("input[name='PRICE']").val()
        let TESTING_SUBJECT = $(this).parent().find("input[name='TESTING_SUBJECT']").val()
       

        
        $.ajax({            
            method: "POST",
            url: "php/back_end_API/C_Update.php",
            data:{
              'HEALTH_CHECK_ID': HEALTH_CHECK_ID,
              'LISTNAME': LISTNAME,
              'PRICE': PRICE,
              'TESTING_SUBJECT': TESTING_SUBJECT,
              
            },            
            dataType: "text",
            success: function (res) {   
              alert("修改成功")     
            },
            error: function(exception) {
              alert("修改失敗")     
            }
        });
      });

    
     



    </script>
</body>

</html>