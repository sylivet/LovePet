<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    @@include('layout/style.html')
    <title>header</title>
</head>

<body>
    @@include('layout/header.html')
    <!-- =================================================側邊攔===================================================== -->
    <div class="m_wrapper" id='app'>
        <my-aside></my-aside>

        <!-- =================================================主要內容===================================================== -->
        <main class="m_member_index">

            <!-- ------------------------------個人頭貼---------------------------------- -->
            <article class="personal_info">

                <my-pic :picsrc='mymember[0].MEMBER_IMG'></my-pic>

                <input type="text" id="m_nickname2" placeholder="您的稱呼" :value='mymember[0].NICKNAME'>


                <p class="m_link"><a href="./member_people.html">查看更多 > </a></p>
            </article>


            <!-- ------------------------------寵物頭貼---------------------------------- -->
            <article class="m_member_pets">
                <h5>我的寵物</h5>
                <div class="m_underline_2"></div>

                <section class="m_pets m_pets_pics">
                    <my-petpic v-for='itm in mymemberpet' :petsrc='itm.PET_IMG' :petname='itm.PET_NAME'></my-petpic>
                </section>

                <p class="m_link"><a href="./member_pets.html">查看更多 > </a></p>
            </article>

            <!------------------------------訂單管理------------------------------->
            <article class="m_member_order">
                <h5>訂單管理</h5>

                <ul class="m_get_type">
                    <li @click="order='complete'"><span @click="chgfocus">已完成</span>
                        <div class="m_underline_3" :style="{ opacity: opacity }"></div>
                    </li>
                    <li @click="order='notyet'"><span @click="chgfocus">未完成</span>
                        <div class="m_underline_3" :style="{ opacity: opacity2 }"></div>
                    </li>
                </ul>
                <div class="m_underline_2"></div>

                <keep-alive>
                    <component :is="order"></component>
                </keep-alive>


                <p class="m_link"><a href="./member_order_management.html">查看更多 > </a></p>
            </article>

        </main>
    </div>
    @@include('layout/footer.html')
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- axios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <!-- vue -->
    <script src="./vendors/vue/js/vue.js"></script>
    <!-- 購物車共用組件 -->
    <script src="js/mall_vue.js"></script>
    <!-- <script src="./js/m_aside_contrl.js"></script> -->
    <script>
       
    //--- 會員
        Vue.component('my-pic',{
                template: `<div>
                            <img :src="picsrc? picsrc : './img/member/Profile-Male-PNG.jpg' " alt="profile"  class="m_person_pic" id="m_pic2">
                            </div>`,
            props: ['picsrc'],
        });
        //--- 寵物
        Vue.component('my-petpic', {
            template: `<section class="m_pets ">
                            <form action="">
                                <div class="m_frame">
                                    <img :src='petsrc? petsrc : "./img/member/Group 2151.jpg"' 
                                    alt="profile"  class="m_pet_pic" id="m_pet2">
                                </div>
                                <div>
                                    <input type="text" id="pet_name2" placeholder="名字" :value='petname'>
                                    <label for="pet_name3"><img src="./img/member/edit_icon.png" alt="edit" style="width: 20px;"></label>
                                </div>
                            </form>
                        </section>`,
            props: ['petsrc', 'petname'],

        });
        //--- 訂單
        Vue.component('complete', {
            template: `
                <div>       
                    <section>
                        <ul class="m_item_details">
                            <li class="m_item_title"><p>種類 <span>購物商城</span></p>
                                <p>訂單編號 <span>S001</span>號</p>
                                <p>下單日期2021-05-24</p>
                            </li>
                            <li><h6>狀&emsp;&emsp;態</h6><p>已完成</p></li>
                            <li><h6>收件人名</h6><p>陳德綸</p></li>
                            <li><h6>收件地址</h6><p>新竹市東區食品路275號</p></li>
                            <li><h6>連絡電話</h6><p>0918812715</p></li>
                        </ul>
            

                        <div class="m_buy_details"  :class="{ 'm_appear': isappear}">
                            <p>項目明細</p>
                            <table>
                                <tr class="m_item_title">
                                    <td  class="m_item_pic">圖片</td>
                                    <td  class="m_item_id">品名 / 類別</td>
                                    <td  class="m_item_type">單組金額</td>
                                    <td  class="m_item_amount">數量</td>
                                    <td  class="m_item_price">小計</td>
                                </tr>
                                <tr>
                                    <td  class="m_item_pic"><img src="./img/member/shoppingsample1.png" alt=""></td>
                                    <td  class="m_item_id">鯊魚造型貓窩/用品</td>
                                    <td  class="m_item_type">479/組</td>
                                    <td  class="m_item_amount">7</td>
                                    <td  class="m_item_price">3353元</td>
                                </tr>
                                <tr>
                                    <td  class="m_item_pic"><img src="./img/member/shoppingsample2.png" alt=""></td>
                                    <td  class="m_item_id">成長碗架/用品</td>
                                    <td  class="m_item_type">279/組</td>
                                    <td  class="m_item_amount">11</td>
                                    <td  class="m_item_price">3069元</td>
                                </tr>
                            </table>
                        </div>
            

                        <div class="m_msg_details " :class="{ 'm_appear': isappear}">
                            <p>留言紀錄</p>
                            <ul>
                                <li class="m_client_ask"><img src="./img/member/Profile-Male-PNG.jpg" alt=""><article><p>想要新貨可以嗎?</p><p>time 2020/04/22 16:00</p></article></li>
                                <li class="m_lovepet_re"><img src="./img/common/i_logo.png" alt=""><article><p>沒問題，我們都是新貨</p><p>time 2020/04/22 16:00</p></article></li>
                                <li class="m_client_ask"><img src="./img/member/Profile-Male-PNG.jpg" alt=""><article><p>好的，感謝!</p><p>time 2020/04/22 16:00</p></article></li>
                                <li class="m_lovepet_re"><img src="./img/common/i_logo.png" alt=""><article><p>不會，應該的。</p><p>time 2020/04/22 16:00</p></article></li>
                            </ul>
                        </div>
                        <div class="m_dt_streth_btn">
                            <input type="button" value="訂單明細" @click="dtoggle">
                        </div>
                        </section>
                </div>
            `,

            methods: {
                dtoggle() {
                    this.isappear = !this.isappear;
                },
            },
            data() {
                return {
                    isappear: true,
                };
            },
        });

        Vue.component('notyet', {
            template: `
            <div>       
                    <section>
                        <ul class="m_item_details">
                            <li class="m_item_title"><p>種類 <span>旅館訂房</span></p>
                                <p>訂單編號 <span>H008</span>號</p>
                                <p>下單日期:2021-06-12</p>
                            </li>
                            <li><h6>狀&emsp;&emsp;態</h6><p>未完成</p></li>
                            <li><h6>房型選擇</h6><p>時毛玩意</p></li>
                            <li><h6>入住日期</h6><p>2021-06-29</p></li>
                            <li><h6>退房日期</h6> <p> 2021-06-30 </p></li>
                            <li><h6>房型價錢</h6><p>5999</p></li>
                            <li><h6>入住數量</h6><p>3個人及1隻寵物</p></li>
                        </ul>

                        <div class="m_buy_details"  :class="{ 'm_appear': isappear}">
                            <p>項目明細</p>
                            <table>
                                <tr class="m_item_title">
                                    <td  class="m_item_pic">圖片</td>
                                    <td  class="m_item_id" style='width:90%;'>敘述</td>
                                    
                                </tr>
                                <tr>
                                    <td  class="m_item_pic"><img src="img/hotel/h_panorama2.jpeg" alt=""></td>
                                    <td  class="m_item_id"  style='width:90%;'>
                                    房內採白色的牆面，配上強烈的紅色沙發，以及對比色系的家具，
                                    形成撞色的時髦感，且窗外撒落的陽光與綠意，讓身處在都市喧囂的我們，
                                    還能觀賞波光粼粼的河面，獲得片刻的寧靜... 另有開放式廚房及餐桌，選用了時尚的大理石桌板，
                                    讓您與家人或朋友，可以享受在房內使用餐點的私人空間，不受他人打擾。</td>
                                    
                                </tr>
                            </table>
                        </div>

                        <div class="m_dt_streth_btn">
                            <input type="button" value="訂單明細" @click="dtoggle">
                        </div>
                    </section>
                </div>
            `,
            methods:{
                dtoggle(){
                    this.isappear = !this.isappear;
                },
            },
            data(){
                return{
                    isappear : true,
                    ltype : '旅館訂房',
                };
            },
        });

        //--- 側邊攔
        Vue.component('my-aside', {
            template:
                ` <aside>
                  <div>
                      <h5><a href="./member_index.html"><img src="./img/member/catlogo-8.png" alt=""><span>會員專區</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></h5>
                      <div class="m_underline_1"></div>
                      <ul>
                          <li><a href="./member_people.html"><img src="./img/member/catlogo-8.png" alt=""><span>我的帳號</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></li>
                          <li><a href="./member_pets.html"><img src="./img/member/catlogo-8.png" alt=""><span>我的寵物</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></li>
                          <li><a href="./member_order_management.html"><img src="./img/member/catlogo-8.png" alt=""><span>訂單管理</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></li>
                          <li class="m_little_li"><a href="./member_order_management.html"><img src="./img/member/catlogo-8.png" alt=""><span>已完成</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></li>
                          <li class="m_little_li"><a href="./member_order_management.html"><img src="./img/member/catlogo-8.png" alt=""><span>未完成</span><img src="./img/member/catlogo-8.png" alt="" class="m_imgblock"></a></li>
                      </ul>
                      <input type="button" value="登 出" @click="mleave" >
                  </div>
                 </aside>`,
            data() {
                return {
                    mconfirm: '確認登出嗎?',
                };
            },
            methods: {
                mleave() {   //--- 登出function
                    if (confirm(this.mconfirm) == true) {
                        localStorage.clear();                            //清除local

                        $.ajax({                                         //清除session ID
                            method: "POST",
                            url: "./php/front_end_API/M_removesession_MID.php",
                            data: {},
                            dataType: "text",
                            success: function success(response) {
                                window.location.href = "front_index.html";
                            },
                            error: function error(exception) {
                                alert("數據載入失敗: " + exception.status);
                            }
                        });

                    } else {

                    };
                },
            },
        });

        //--- 主鍵Vue
        new Vue({
            el: '#app',
            data: {
                order: 'complete',
                opacity: 1,
                opacity2: 0,

                mymember: [],
                mymemberpet: [],
            },
            methods: {
                chgfocus() {
                    if (this.opacity == 0) { this.opacity = 1 } else { this.opacity = 0 }
                    if (this.opacity2 == 0) { this.opacity2 = 1 } else { this.opacity2 = 0 }
                },
                getmymemberdata(info) {
                    let self = this;

                    $.ajax({
                        type: "POST",
                        url: "./php/front_end_API/M_apr_memberpeople.php",
                        data: {
                            MID: info,            //---透過 MID 去抓該筆會員資料
                        },
                        dataType: 'html'
                    }).done(function (data) {    //---載入成功
                        console.log(data);
                        self.mymember = JSON.parse(data);

                    }).fail(function (jqXHR) {   //---載入失敗
                        alert("res為ID數據載入失敗: " + jqXHR.status);
                    });

                },
                getmemberpetdata(info) {
                    let self = this;

                    $.ajax({
                        type: "POST",
                        url: "./php/front_end_API/M_apr_memberpet.php",
                        data: {
                            MID: info,            //---透過 MID 去抓該筆會員資料
                        },
                        dataType: 'html'
                    }).done(function (data) {    //---載入成功
                        console.log(data);
                        self.mymemberpet = JSON.parse(data);

                    }).fail(function (jqXHR) {   //---載入失敗
                        alert("res為ID數據載入失敗: " + jqXHR.status);
                    });

                },
            },
            created() {

                axios.post("php/front_end_API/M_getsession_MID.php").then((res) => {
                    this.getmymemberdata(res.data);
                    this.getmemberpetdata(res.data);
                });


            },
        });



    </script>
</body>

</html>