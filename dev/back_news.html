<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" />
  @@include('layout/style.html')
  <title>樂寵後台管理</title>
</head>

<body class="backend">
  <nav class="navbar navbar-light" style="background-color: #ffc857">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <img class="ms-5" src="img/common/i_logo.png" alt="" style="max-width: 50px" />
        <p class="navbar-brand ms-3">樂寵後台管理</p>
      </div>
      <div class="me-5"><a href="#">登出</a></div>
    </div>
  </nav>
  <div class="container mt-5">
    <div class="row">
      <div class="col-2">
        <div class="list-group text-center">
          <a href="back_member.html" class="
              list-group-item list-group-item-action list-group-item-success
            ">會員管理</a>
          <a href="back_news.html" class="
              list-group-item list-group-item-action list-group-item-success
            ">消息管理</a>
          <a class="
              list-group-item list-group-item-action list-group-item-success
            " data-bs-toggle="collapse" href="#order-list" role="button" aria-expanded="false"
            aria-controls="order-list"><span class="badge bg-success rounded-pill">0</span> 訂單管理</a>
          <div class="collapse" id="order-list">
            <a href="back_restaurant_order.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              "><span class="badge bg-success rounded-pill">0</span> 餐廳訂單</a>
            <a href="back_hotel_order.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              "><span class="badge bg-success rounded-pill">0</span> 旅館訂單</a>
            <a href="back_hospital_order.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              "><span class="badge bg-success rounded-pill">0</span> 健檢訂單</a>
            <a href="back_shopping_order.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              "><span class="badge bg-success rounded-pill">0</span> 商城訂單</a>
          </div>
          <a class="
              list-group-item list-group-item-action list-group-item-success
            " data-bs-toggle="collapse" href="#product-list" role="button" aria-expanded="false"
            aria-controls="product-list">商品管理</a>
          <div class="collapse" id="product-list">
            <a href="back_restaurant_meal.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              ">餐廳餐點</a>
            <a href="back_room_type.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              ">旅館房型</a>
            <a href="back_health_check.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              ">健檢項目</a>
            <a href="back_shopping_product.html" class="
                list-group-item
                list-group-item-action
                list-group-item-secondary
              ">商城商品</a>
          </div>
          <a href="back_message_list.html" class="
              list-group-item list-group-item-action list-group-item-success
            "><span class="badge bg-success rounded-pill">0</span> 商城留言</a>
        </div>
      </div>
      <div class="col-10">
        <h2 class="mb-3">消息管理</h2>
        <a href="back_news_create.html" class="btn btn-success btn-sm mb-3">新增消息</a>
        <div class="d-flex justify-content-between mb-3">
          <select>
            <option value="1">上架中</option>
            <option value="0">下架中</option>
          </select>
        </div>
        <table class="table table-striped table-hover text-center">
          <thead>
            <tr class="table-warning">
              <th>消息編號</th>
              <th>消息標題</th>
              <th>消息圖片</th>
              <th>消息內容</th>
              <th>消息狀態</th>
              <th>編輯</th>
            </tr>

          </thead>
          <tbody class="data">
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <script>
     axios.post("php/back_end_API/I_select.php").then((res) => {
      getData(res)
    })
    function getData(res) {
      for (let i = 0; i < res.data.length; i++) {

        let data = `
          <tr>
                <td style="display: none"><input value="${res.data[i].NEWS_ID}" name="NEWS_ID" disabled readonly></td>
                <td>${res.data[i].NEWS_ID}</td>
                <td><input type="text" name="NEWS_TITLE" value="${res.data[i].NEWS_TITLE}" disabled></td>
                <td style="display: none"><input type="text" name="NEWS_IMG" value="${res.data[i].NEWS_IMG}" disabled></td>
                <td><img src="${res.data[i].NEWS_IMG}" style="width:100px;"></td>
                <td>
                  <textarea name="NEWS_CONTENT" id="" cols="30" rows="3" disabled>${res.data[i].NEWS_CONTENT}</textarea>
                <td>
                  <select name="NEWS_STATUS" disabled>
                    <option class="noShow" value="${res.data[i].NEWS_STATUS}" selected>${res.data[i].NEWS_STATUS === "1" ? "上架" : "下架"}</option>
                    <option value="0">下架</option>
                    <option value="1">上架</option>
                  </select>
                </td>
                <td class="edit"><button class="btn btn-warning btn-sm">編輯</button></td>
                <td style="display: none" class="save"><button class="btn btn-warning btn-sm">儲存</button></td>
          </tr>
          `
        $('.data').append(data)
      }
    }

    // 動態append無法click事件點擊該元件，要改為on綁定先抓到父層後，才點擊該元件。

    //編輯
    $('.data').on('click', '.edit', function (e) {
      e.preventDefault()
      $(this).parent().find('input, select, textarea').attr('disabled', false)
      $(this).css('display', 'none')
      $(this).next().css('display', 'block')
      $('.noShow').hide()
    });

    //儲存
    $('.data').on('click', '.save', function () {
      $(this).parent().parent().find('input, select, textarea').attr('disabled', true)
      $(this).css('display', 'none')
      $(this).prev().css('display', 'block')

      let NEWS_ID = $(this).parent().find("input[name='NEWS_ID']").val()
      let NEWS_TITLE = $(this).parent().find("input[name='NEWS_TITLE']").val()
      let NEWS_IMG = $(this).parent().find("input[name='NEWS_IMG']").val()
      let NEWS_CONTENT = $(this).parent().find("textarea[name='NEWS_CONTENT']").val()
      let NEWS_STATUS = $(this).parent().find("select[name='NEWS_STATUS']").val()


      $.ajax({
        method: "POST",
        url: "php/back_end_API/I_Update.php",
        data: {
          'NEWS_ID': NEWS_ID,
          'NEWS_TITLE': NEWS_TITLE,
          'NEWS_IMG': NEWS_IMG,
          'NEWS_CONTENT': NEWS_CONTENT,
          'NEWS_STATUS': NEWS_STATUS,
        },
        dataType: "text",
        success: function (res) {
          alert("修改成功")
        },
        error: function (exception) {
          alert("修改失敗")
        }
      });
    });
  </script>
</body>

</html>